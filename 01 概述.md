# 01 概述

## 1.1 计算机网络的基本概念

### 1.1.1 计算机网络的定义

计算机网络是指将地理上分散的具有独立功能的多台计算机及其外部设备，通过通信线路和通信设备连接起来，在网络操作系统、网络管理软件及网络通信协议的管理和协调下，实现资源共享和信息传递的计算机系统。

### 1.1.2 计算机网络的功能

1. **数据通信**：实现计算机之间及计算机与终端之间的信息传递，是网络最基本的功能，如电子邮件、视频通话等。
2. **资源共享**：包括硬件资源（如打印机、存储设备）、软件资源（如应用软件、数据库）和数据资源的共享，提高资源利用率。
3. **分布式处理**：将复杂的任务分解为多个子任务，由网络中的多台计算机分别处理，协同完成，提高处理效率。
4. **提高可靠性**：通过多台计算机互为备份，当某台计算机出现故障时，可由其他计算机替代工作，保障系统的持续运行。
5. **负载均衡**：将任务均匀分配到网络中的多台计算机，避免单台计算机负载过重，提高系统整体性能。

### 1.1.3 计算机网络的组成

1. **硬件部分**：包括主机（服务器、客户机）、通信线路（双绞线、光纤、无线信道等）、网络设备（路由器、交换机、集线器、网卡等）。
2. **软件部分**：包括网络操作系统（如 Windows Server、Linux）、网络协议（如 TCP/IP 协议簇）、网络应用软件（如浏览器、FTP 客户端）。
3. **协议**：是计算机网络中通信双方必须遵守的规则和约定，规定了数据的格式、传输顺序、差错控制等内容，是网络正常运行的基础。

## 1.2 计算机网络的发展历程

### 1.2.1 第一阶段：面向终端的计算机网络（20 世纪 50 年代 - 60 年代）

早期的计算机价格昂贵，一台计算机通常连接多个终端（如电传打字机），终端没有独立处理能力，仅负责输入输出。此时的网络以单台计算机为中心，主要实现终端与计算机之间的通信，如美国航空公司的预订系统。

### 1.2.2 第二阶段：分组交换网络的出现（20 世纪 60 年代 - 70 年代）

1969 年，美国国防部高级研究计划局（ARPA）建立了 ARPANET，这是计算机网络发展的里程碑。ARPANET 采用分组交换技术，将数据分割成分组进行传输，多个终端可共享通信线路，提高了线路利用率。分组交换技术为现代计算机网络奠定了基础。

### 1.2.3 第三阶段：互联网的形成（20 世纪 80 年代 - 90 年代）

20 世纪 80 年代，TCP/IP 协议被确定为 ARPANET 的标准协议，使得不同类型的网络可以互联，形成了互联网的雏形。1983 年，ARPANET 分为军用和民用两部分，民用部分逐渐发展为互联网。20 世纪 90 年代，万维网（WWW）的出现极大地推动了互联网的普及，使得信息浏览更加便捷。

### 1.2.4 第四阶段：现代互联网的发展（21 世纪至今）

进入 21 世纪，互联网呈现出高速发展的态势，移动互联网、物联网、云计算、大数据等新技术不断涌现。网络传输速率大幅提升，从最初的几 kbps 到如今的 Gbps 级别；网络覆盖范围不断扩大，从局部地区扩展到全球；应用场景也更加丰富，涵盖了社交、电商、教育、医疗等各个领域。

## 1.3 互联网的组成

### 1.3.1 电路交换

- 优点：

	- 传输延迟小：通路独占，数据无需在路由器排队等待，延迟仅包括物理链路的传播延迟。
	- 无失序和丢失：数据按顺序连续传输，不会因其他数据插入导致失序，也不会因资源竞争导致丢失。
	- 适合实时传输：对延迟敏感的场景（如语音、视频通话）友好。

- 缺点：

	- 资源利用率低：通路建立后，即使无数据传输，资源也被独占（例如电话接通后双方沉默，带宽仍被占用），核心网络资源无法高效共享。
	- 灵活性差：连接建立后，通路的带宽、路由固定，无法根据网络流量动态调整；若通路中某段链路故障，需重新建立连接。
	- 不适合突发数据：互联网中大部分数据是 “突发式” 的（如浏览网页、发送邮件，数据间歇性传输），电路交换的 “独占资源” 特性会造成大量资源浪费。

- 适用场景：

	传统电话网络、专用通信线路（如企业间固定带宽的专线），不适合互联网的通用数据传输。

### 1.3.2 分组交换（Packet Switching）：“分片转发” 式交换

分组交换是**互联网核心部分采用的主流交换方式**，解决了电路交换资源利用率低的问题，核心思路是 “**将数据分片，以‘分组’为单位独立转发**”，无需预先建立专用通路。

1. 基本原理：

	分组交换的流程可分为 “分组封装” 和 “存储 - 转发” 两步：

	- 步骤 1：分组封装（数据分片）：

		源主机将需要传输的 “报文”（如一个文件、一段视频数据）分割成若干个

		固定长度的分组（Packet）

		（互联网中分组长度通常为几百字节到几千字节）。每个分组由两部分组成：

		- **首部（Header）**：包含控制信息，核心是 “源 IP 地址” 和 “目的 IP 地址”（用于路由器转发），还包括分组序号（用于目的主机重组）、校验和（用于差错检测）等。

		- 数据部分（Payload）：从原始报文中分割出来的部分数据。

			例如，一个 10MB 的文件，若每个分组长度为 1KB，则会被分割成 10240 个分组，每个分组都带有独立的首部。

	- 步骤 2：存储 - 转发（独立转发）：

		每个分组通过核心网络时，采用 “存储 - 转发（Store-and-Forward）” 机制：

		关键特点：

		每个分组独立选择路由

		—— 由于网络流量动态变化，不同分组可能经过不同的路由到达目的主机（例如，第一个分组走 “路由器 A→路由器 B”，第二个分组走 “路由器 A→路由器 C→路由器 B”），但目的主机可通过序号重组，不影响最终数据完整性。

		1. 分组到达某台路由器后，路由器先将分组 “存储” 在内存中（暂存），并检查分组首部的目的 IP 地址。
		2. 路由器查询自身的 “路由表”，确定该分组下一步应转发到的下一个路由器（下一跳）。
		3. 路由器等待当前链路空闲时，将分组 “转发” 到下一跳路由器，重复此过程，直到分组到达目的主机。
		4. 目的主机接收所有分组后，根据分组首部的 “序号” 将分组重组为原始报文，完成数据传输。

2. 优缺点：

	- 优点：
		- 资源利用率高：无需独占通路，路由器的链路资源按 “分组” 动态分配，多个用户的分组可共享同一条链路（“统计复用”），适合互联网的突发数据传输，资源浪费少。
		- 灵活性强：分组独立转发，可根据网络流量动态调整路由（如某条链路拥堵时，后续分组可选择其他空闲链路）；若某段链路故障，仅影响经过该链路的分组，其他分组可重新选路，可靠性更高。
		- 无需建立连接：源主机可直接发送分组，无需等待连接建立，响应速度快。
	- 缺点：
		- 传输延迟较大且不固定：每个分组在路由器需经历 “存储 - 检查 - 转发” 的过程，会产生 “排队延迟”（若链路繁忙，分组需排队等待）；不同分组的路由不同，延迟也不同，不适合对延迟敏感的实时业务（如高清语音通话）。
		- 可能出现分组丢失或失序：若路由器内存不足（如流量过大），可能丢弃无法存储的分组；不同分组的传输延迟不同，可能导致目的主机接收的分组顺序与发送顺序不一致（需通过序号重组解决）。
		- 额外开销：每个分组都需携带首部（控制信息），会占用一定的带宽，造成 “额外开销”（分组越小，首部占比越高，开销越大；分组越大，排队延迟越大，需平衡分组长度）。

- 适用场景：

	互联网的绝大多数数据传输，如网页浏览（HTTP）、文件传输（FTP）、电子邮件（SMTP）、视频点播（非实时）等，是目前互联网核心交换方式的绝对主流。

### 1.3.3 报文交换（Message Switching）：“整体转发” 式交换

报文交换是介于电路交换和分组交换之间的一种交换方式，核心特点是 “**不分片，以完整报文为单位进行存储 - 转发**”，无需建立专用通路。

1. 基本原理：
	- 源主机将完整的 “报文”（如一个大文件、一封长邮件）直接发送到核心网络，报文首部包含目的地址等控制信息（无分片，报文长度不固定，可能很大）。
	- 路由器接收报文后，先将整个报文存储在内存中，检查首部的目的地址，查询路由表后，将完整报文转发到下一跳路由器，重复 “存储 - 转发” 过程，直到报文到达目的主机。
2. 优缺点：
	- 优点：
		- 无需建立连接：与分组交换类似，可直接发送数据，资源利用率高于电路交换。
		- 无分片 / 重组开销：目的主机无需对分组进行重组，减少了处理开销（仅适用于报文长度较小的场景）。
	- 缺点：
		- 传输延迟大且不稳定：报文长度通常较大（可能达几 MB 甚至几十 MB），路由器存储和转发整个报文所需的时间长；若报文过大，路由器需占用大量内存，且链路繁忙时，报文排队等待的时间会显著增加，延迟远大于分组交换。
		- 资源利用率低：大报文在路由器中存储和转发时，会长时间占用链路资源，导致其他报文排队等待，容易造成 “链路拥堵”；若报文丢失，需重新传输整个报文（分组交换仅需重传丢失的分组），可靠性低于分组交换。
		- 不适合大报文和突发数据：报文长度越大，延迟和资源占用越严重，无法适应互联网中突发、多样的数据传输需求。

- 适用场景：

	早期的电报系统、某些特定的低速数据传输场景，目前在互联网中应用较少。

### 1.3.4 分组交换成为互联网核心的原因

1. 适应突发数据：互联网中大部分数据（如浏览、下载）是间歇性的，分组交换的 “按需转发” 特性可灵活应对。

2. 可靠性高：分组独立选路，某条链路故障时，其他分组可通过备用路由传输，提升了网络的抗故障能力。

	尽管分组交换存在延迟不固定、需处理分组重组等问题，但通过后续的 “传输控制协议（TCP）”（解决可靠性、失序问题）和 “服务质量（QoS）” 技术（优化实时业务延迟），这些问题已得到有效缓解，使其成为互联网核心交换方式的不二之选。

## 1.4 计算机网络的分类（补充分类方式）

### 1.4.1 按网络的拓扑结构分类

1. **总线型网络**：所有计算机连接到一条共享的通信总线上，结构简单、成本低，但总线故障会影响整个网络，适用于小型网络。
2. **星型网络**：以中心节点为核心，其他节点都与中心节点相连，中心节点控制全网通信，可靠性高、易于管理，但中心节点故障会导致全网瘫痪，是目前局域网中常用的拓扑结构。
3. **环型网络**：各节点首尾相连形成闭合环路，数据沿一个方向传输，传输延迟固定，但某一节点故障会影响全网，适用于对实时性要求较高的场景。
4. **树型网络**：是星型网络的扩展，具有层次结构，适用于大型网络的分级管理，但高层节点故障影响范围大。
5. **网状网络**：节点之间有多条冗余链路，可靠性高、容错能力强，但结构复杂、成本高，常用于广域网（如互联网骨干网）。

### 1.4.2 按网络的使用者分类

1. **公用网**：由电信运营商建设和管理，向公众开放服务，如中国移动、中国联通的网络。
2. **专用网**：由特定机构或企业自行建设和管理，仅供内部使用，如企业内网、校园网。

### 1.4.3 按传输技术分类

1. **广播式网络**：所有节点共享一个通信信道，一个节点发送数据，其他节点均可接收，如以太网、无线局域网。
2. **点到点网络**：节点之间通过多条链路连接，数据从源节点通过中间节点转发到目的节点，如广域网中的大多数网络。

## 1.5 计算机网络的类别

### 1.5.1 按照网络的作用范围进行分类

1. 广域网 WAN（Wide Area Network）
	- 覆盖范围：几十到几千公里，可跨越国家甚至全球。
	- 特点：传输速率相对较低，延迟较高，通常使用光纤、卫星等远程通信技术。
	- 应用：互联网的核心部分，连接不同地区的局域网或城域网。
2. 城域网 MAN（Metropolitan Area Network）
	- 覆盖范围：一个城市或城市的一部分，约 5~50 公里。
	- 特点：介于 LAN 与 WAN 之间，常用于连接多个局域网。
	- 应用：城市范围内的政府、企业、学校等机构的网络互联。
3. 局域网 LAN（Local Area Network）
	- 覆盖范围：一般在 1 公里以内，如同一个办公室、学校或家庭。
	- 特点：高速、低延迟，建设和维护成本较低。
	- 应用：公司内部网络、校园网、家庭网络等。
4. 个域网 PAN（Personal Area Network）
	- 覆盖范围：10 米以内，围绕个人设备。
	- 特点：低功耗、短距离通信。
	- 应用：蓝牙、红外、USB 连接等个人设备之间的通信。

## 1.6 计算机网络的性能指标

### 1.6.1 计算机网络的性能指标

1. 速率：
	- 定义：数据的传输速率，即单位时间内传输的数据量。
	- 单位：bit/s（bps）、kb/s（kbps）、Mb/s（Mbps）、Gb/s（Gbps）等。
	- 注：通常指额定速率或标称速率，是设备所能达到的最大传输速率。
2. 带宽：
	- 定义：在单位时间内从网络的某一点到另一点所能通过的 “最高数据率”。
	- 单位：与速率相同，如 bps、Mbps 等。
	- 意义：表示网络的通信线路所能传送数据的能力，是衡量网络传输能力的重要指标。
3. 吞吐量 (Throughput)：
	- 定义：单位时间内**实际成功交付**到目的端的**有效数据量**。
	- 单位：bit/s（bps）、Byte/s、packet/s 等。
	- 与带宽的区别：
		- 带宽：链路**理论上最大能传多少**。
		- 吞吐量：**真实跑起来传了多少**（≤带宽）。
	- 影响因素：拥塞、协议开销、重传、路由抖动、CPU / 接口性能、信噪比等。
4. 时延：
	- 定义：数据从网络的一端传送到另一端所需的时间。
	- 组成：发送时延（数据块长度 / 信道带宽）、传播时延（信道长度 / 电磁波在信道上的传播速率）、处理时延（路由器处理分组的时间）、排队时延（分组在路由器队列中等待的时间）。
	- 总时延 = 发送时延 + 传播时延 + 处理时延 + 排队时延。
5. 时延带宽积：
	- 定义：时延带宽积 = 传播时延 × 带宽，表示链路中可以容纳的比特数，又称以比特为单位的链路长度。
6. 往返时间 RTT：
	- 定义：从发送方发送数据开始，到发送方收到来自接收方的确认（接收方收到数据后立即发送确认）所经历的时间。
	- 意义：在许多协议中，RTT 是一个重要的参数，如 TCP 的超时重传时间设置。
7. 利用率：
	- 定义：包括信道利用率和网络利用率。信道利用率是指某信道被使用的时间占总时间的比例；网络利用率是指全网络的信道利用率的加权平均值。
	- 注：信道利用率并非越高越好，当利用率接近 100% 时，网络时延会急剧增大。

## 1.7 计算机网络体系结构

### 1.7.1 计算机网络体系结构的形成

（各功能均因 “复杂网络需分层治理” 而逐步提炼，成为 OSI/TCPIP 模型分层依据）

1. 差错控制
	- 目的：让 “不可靠信道” 变 “可靠”
	- 手段：检错码（CRC）、确认重传（ARQ）、超时计时器
	- 分层：主要放在**数据链路层**（逐链路）与**传输层**（端到端）
2. 流量控制
	- 目的：防止发送方 “淹没” 接收方
	- 手段：滑动窗口、速率整形、背压（Back-pressure）
	- 分层：**链路层**（停等、后退 N 帧）、**传输层**（TCP 窗口、拥塞避免）
3. 分段和重装
	- 目的：大数据块超过下层 MTU 时需切片；接收端按序拼回
	- 手段：标识、序号、片偏移、MF/DF 标志、重装计时器
	- 分层：**网络层**（IP 分片）、**传输层**（TCP/UDP 分段）
4. 路由
	- 目的：决定分组从源到目的的最佳路径
	- 手段：静态表、距离向量、链路状态、BGP 策略路由
	- 分层：**网络层**核心功能；路由协议（OSPF、BGP）属**应用层**实现
5. 复用和分用
	- 复用：多路高层会话共用同一条低层链路
	- 分用：到达后依据字段（端口、协议号）正确上交
	- 分层：
		- **传输层**：端口→区分进程（TCP/UDP 复用 / 分用）
		- **网络层**：协议字段→区分 ICMP/IGMP/TCP/UDP
		- **链路层**：类型字段→区分 IP/ARP
6. 连接建立和释放
	- 目的：通信前先同步状态，通信后安全回收资源
	- 建立：三次握手；释放：四次挥手；附带序号同步、选项协商
	- 分层：主要出现在**传输层**（TCP）、**会话层**（OSI）；部分链路协议（PPP、HDLC）也有类似阶段

#### 开放系统互联参考模型 OSI/RM

> 七层模型 —— 从底到顶，**“物链网传会表应”**

1. **七层 & 数据单元 & 核心任务**

| 层         | 英文名       | 数据单元    | 一句话任务                 | 典型协议 / 设备              |
| ---------- | ------------ | ----------- | -------------------------- | ---------------------------- |
| 7 应用     | Application  | APDU / 报文 | 为用户进程提供网络接口     | HTTP, FTP, DNS, SMTP         |
| 6 表示     | Presentation | PPDU        | 数据格式、加密、压缩       | SSL/TLS, JPEG, ASN.1         |
| 5 会话     | Session      | SPDU        | 建立 / 管理 / 同步会话     | NetBIOS, RPC                 |
| 4 传输     | Transport    | 段 / 报文   | 端到端可靠或不可靠传输     | TCP, UDP                     |
| 3 网络     | Network      | 分组 / 包   | 路由选择与逻辑寻址         | IP, ICMP, OSPF, 路由器       |
| 2 数据链路 | Data Link    | 帧          | 节点 - 节点可靠 + 差错控制 | Ethernet, PPP, 网桥 / 交换机 |
| 1 物理     | Physical     | 比特        | 透明比特流传输             | 电缆、光纤、集线器、中继器   |

1. 各层功能口诀**“物”**传比特，**“链”** 成帧；**“网”**选路，**“传”** 端到；**“会”**对话，**“表”** 格式；**“应”** 用接口最终到。
2. **层间通信 2 关键词**
	- **SAP（Service Access Point）**：同一节点相邻层接口，如端口 = 传输层 SAP
	- **PDU（Protocol Data Unit）**：本层协议所处理的数据单位，加上首部后交给下一层
3. **OSI vs TCP/IP 快速对照**

| OSI 七层           | TCP/IP 四层 | 说明                  |
| ------------------ | ----------- | --------------------- |
| 应用 + 表示 + 会话 | → 应用层    | OSI 细分，TCP/IP 合并 |
| 传输               | → 传输层    | 功能一致              |
| 网络               | → 网络层    | 功能一致              |
| 数据链路 + 物理    | → 链路层    | TCP/IP 不进一步细分   |

1. **面试 / 选择 6 连击**

	1. **哪层负责路由？** 网络层
	2. **哪层进行流量控制？** 传输层（主要）+ 链路层
	3. **哪层处理比特同步？** 物理层
	4. **交换机工作在第几层？** 默认二层（MAC）；三层交换机在网络层
	5. **路由器工作在第几层？** 网络层
	6. **HTTP 在哪层？** 应用层

2. **一张草图（10 秒画）**

	```plaintext
	┌─────应用(7)─────┐
	├─────表示(6)─────┤  ← 用户数据
	├─────会话(5)─────┤
	├─────传输(4)─────┤  ← 段/报文
	├─────网络(3)─────┤  ← 包/分组
	├─────链路(2)─────┤  ← 帧
	└─────物理(1)─────┘  ← 比特
	      ↑
	向下封装·向上解封
	```

	✅ 一句话总结：**“七层模型物链网传会表应，下三层通信子网，上三层资源子网，传输层是端到端分水岭。”**

#### 非国际标准 TCP/IP（事实上的国际标准）

- **定义**：由 ARPAnet 实践先行、IETF 社区自发制定的协议簇，包含 TCP、IP、UDP、ICMP、ARP、HTTP、DNS 等数百个 RFC，**未经 ISO/ITU-T 等正式立法机构批准**，却因互联网规模扩张成为 “**市场选择的全球通用标准**”。
- 特点
	- 先协议后模型：先有实现再抽象为四层（应用 - 传输 - 网络 - 链路），与 OSI 七层理想模型错位；
	- 开放免费：RFC 公开，无专利壁垒，快速迭代；
	- 简化实用：去掉表示层、会话层，把流量控制、差错控制、连接管理并入传输层与链路层，易于商用实现。
- **结果**：虽未获 “法律上国际标准” 地位，却凭借**早发布、易实现、免费使用**占据全球市场，成为**事实上的唯一国际互联网标准**

### 1.7.2 协议与划分层次

> 核心：网络按 “功能” 切片 → 每层运行一组**协议**（规则 + 格式 + 时序），**协议三要素 + 接口 + 数据封装**

1. **协议（Protocol）三要素**

| 要素 | 内容            | 例子                          |
| ---- | --------------- | ----------------------------- |
| 语法 | 数据格式 / 结构 | TCP 首部 20 B，端口占 2 B     |
| 语义 | 字段含义与操作  | SYN=1 表示 “请求同步”         |
| 同步 | 事件先后关系    | 三次握手：SYN → SYN/ACK → ACK |

1. **层次划分原则（面试 4 连）**

	1. 每层**功能明确**—— 只干一件事
	2. 层间**接口清晰**——SAP + 最少信息
	3. **对等通信**—— 同层协议实体 “虚拟对话”
	4. **封装 / 解封**—— 数据 + 本层首部 → 交给下一层

2. **封装解封流程（10 秒画）**

	```plaintext
	App 数据
	↓ ＋H7
	Segment (H6)  ← 传输层
	↓ ＋H5
	Packet   (H5)  ← 网络层
	↓ ＋H4＋T4
	Frame    (H4+T4) ← 链路层
	↓ 比特
	物理链路
	```

	> 接收端反向逐层拆头 / 尾，上交。

3. **关键术语（选择 / 填空）**

	- **PDU**（Protocol Data Unit）：本层协议处理的数据单位
	- **SAP**（Service Access Point）：相邻层接口，如 “端口”= 传输层 SAP
	- **对等实体**（Peer Entity）：不同机器同一层的协议实例
	- **虚拟通信**（Virtual Communication）：逻辑上同层直接对话，实际沿实线箭头经过下层

4. **一张图秒懂 “协议栈”**

	```plaintext
	主机A                      主机B
	┌─────┐ 虚拟通信  ┌─────┐
	│应用层│←─HTTP──→│应用层│
	├─────┤          ├─────┤
	│传输层│←─TCP──→│传输层│
	├─────┤          ├─────┤
	│网络层│←─IP───→│网络层│
	├─────┤          ├─────┤
	│链路层│←─Eth──→│链路层│
	└─────┘          └─────┘
	  ↑物理层↑ 真实比特流 ↑物理层↑
	```

5. **面试金句**

	> “协议是水平的 —— 对等实体遵守；服务是垂直的 —— 上层使用下层功能。”

### 1.7.3 具有五层协议的体系结构

#### 1 为什么提出五层模型？

| 背景        | 痛点                                                         |
| ----------- | ------------------------------------------------------------ |
| OSI 七层    | 理论完美，但表示 / 会话层在现实中常被合并，太细              |
| TCP/IP 四层 | 事实标准，但 “链路 + 物理” 一层不利于初学者理解硬件 vs 软件职责 |
| 教学折中    | 把 “链路” 再拆成物理 + 数据链路 → **五层清晰、可画、可考**   |

#### 2 五层速查表

| 层         | 英文名      | 数据单元     | 地址标识                      | 核心功能                                      | 典型协议 / 标准                     | 典型设备             |
| ---------- | ----------- | ------------ | ----------------------------- | --------------------------------------------- | ----------------------------------- | -------------------- |
| 5 应用     | Application | 报文 message | 进程标识（端口）              | 用户进程 ↔ 网络服务                           | HTTP, FTP, SMTP, DNS, DHCP          | 网关、应用层防火墙   |
| 4 传输     | Transport   | 段 segment   | 端口 (16 bit)                 | 端到端进程寻址 + 可靠 / 流量 / 拥塞控制       | TCP, UDP, QUIC                      | 传输层网关           |
| 3 网络     | Network     | 分组 packet  | IP 地址 (32/128 bit)          | 逻辑寻址、路由选择、分组转发                  | IP, ICMP, ARP, OSPF, BGP            | 路由器、三层交换机   |
| 2 数据链路 | Data Link   | 帧 frame     | MAC 地址 (48 bit)             | 节点 - 节点可靠、差错检测、流量控制、介质访问 | Ethernet V2, PPP, HDLC, IEEE 802.11 | 网桥、二层交换机     |
| 1 物理     | Physical    | 比特 bit     | 无地址，按 “时钟 + 信号” 识别 | 透明比特流传输、电气 / 光学特性、机械接口     | RJ-45, 光纤，Wi-Fi 射频，1000BASE-T | 集线器、中继器、网线 |

#### 3 各层深度拆解

##### 3.1 物理层（位流）

- **四大特性**（机械、电气、功能、规程）
- **信号类型**：基带 / 宽带、模拟 / 数字、编码（NRZ, Manchester）
- **带宽与波特率**：波特率 = 符号率；奈氏准则→最大码元速率，香农→最大信息速率
- **传输介质**：双绞线 (UTP/STP)、同轴、光纤 (单 / 多模)、无线 (2.4 GHz/5 GHz)
- **设备**：集线器（Hub）→ 物理层广播放大，不识别帧

##### 3.2 数据链路层（帧）

- **成帧**：字符计数、首尾标志、比特填充（HDLC）、违规编码（以太网前导码）

- **差错控制**：CRC（循环冗余检验）、海明码

- **流量控制**：停等、回退 N 帧 (GBN)、选择重传 (SR)

- 介质访问

	（广播型链路）：

	- 静态：FDM、TDM、WDM
	- 动态：CSMA/CD（以太网）、CSMA/CA（Wi-Fi）、令牌传递

- **以太网帧格式**：7B 前导 + 1B SFD+14B 头 + 数据 + 4B FCS → 最大 1518 B（不含 VLAN）

- **设备**：网桥 / 交换机 → 自学习、隔离冲突域、不隔离广播域

##### 3.3 网络层（分组）

- **逻辑地址**：IPv4 32 位点分十进制、IPv6 128 位冒分十六
- **分类编址 → CIDR**：网络号 + 主机号 → 前缀 / 掩码，路由聚合
- **ARP 解析**：IP→MAC；免费 ARP 检测冲突
- **ICMP 控制 / 差错**：Echo(ping)、Destination Unreachable、TTL-exceeded(Traceroute)
- 路由算法：
	- 静态 / 动态；域内 (RIP - 距离向量、OSPF - 链路状态)、域间 (BGP - 路径向量)
- **分组转发**：最长前缀匹配、下一跳、默认路由
- **设备**：路由器 → 隔离广播域，基于 IP 地址转发，维护路由表

##### 3.4 传输层（段）

- **复用 / 分用**：源端口 + 目的端口 + 协议号 → 唯一套接字
- **UDP**：无连接、无状态、首部 8 B、校验和可选、适用于 DNS/DHCP/ 视频流
- TCP：
	- 可靠：序号、确认、重传（超时 + 快速重传）
	- 流量控制：滑动窗口、接收窗口 (rwnd)
	- 拥塞控制：慢启动、拥塞避免、快速重传 / 恢复、拥塞窗口 (cwnd)
	- 连接管理：三次握手、四次挥手、有限状态机、TIME_WAIT 2MSL
- **SCTP/QUIC**：多流、多宿、低延迟握手机制（1-RTT/0-RTT）

##### 3.5 应用层（报文）

- **客户 / 服务器 vs P2P**
- **DNS**：递归 + 迭代查询、端口 53、UDP 为主、资源记录 (A/AAAA/CNAME/MX/NS)
- **HTTP/1.1**：持久连接、流水线、Cookie/Session、状态码 1xx-5xx
- **HTTPS**：TLS 握手 (1.3→0-RTT)、加密套件、证书链
- **Email**：SMTP (发)- 端口 25/587、POP3 (收)-110、IMAP-143
- **FTP**：控制 21 + 数据 20 (主动)/ 随机 (被动)
- **DHCP**：Discover→Offer→Request→ACK，67/68 UDP，四步租约

#### 4 数据封装 / 解封全流程（五层视角）

假设主机 A → 主机 B 发送一条 HTTP GET：

```plaintext
【应用层】HTTP GET 报文
↓ +应用头（0 B，HTTP 无额外头）
【传输层】TCP 段：+20 B 首部（源端口随机，目的80，Seq，Ack）
↓ +网络头 20 B（IP 头：源 IP，目的 IP，协议=6，总长度）
【链路层】以太网帧：+14 B 头（DMAC+SMAC+类型）+4 B FCS
↓ → 比特流
【物理层】1000BASE-T 电信号 → 经过交换机、路由器 → B
```

B 从物理层逐层拆头，上交至浏览器进程。

#### 5 与 OSI / TCP/IP 的横向对比

| 维度        | OSI 七层         | 五层教学       | TCP/IP 四层     |
| ----------- | ---------------- | -------------- | --------------- |
| 层数        | 7                | 5              | 4               |
| 表示 / 会话 | 独立             | 并入应用       | 并入应用        |
| 物理 / 链路 | 独立             | 独立           | 合并为 “链路”   |
| 法律地位    | 国际标准 (ISO)   | 教学标准       | 事实标准 (IETF) |
| 使用场景    | 理论、考试、论文 | 课堂、考研大题 | 工程实现        |

#### 6 经典计算与题型

1. 封装后总长度

	1500 B IP 数据报 → 以太网帧 = 1500 + 14 + 4 =1518 B

	（不含 8 B 前导）

2. 协议字段值

	IP 上层协议号：TCP=6，UDP=17，ICMP=1

	以太网类型：Iv4=0x0800，ARP=0x0806，IPv6=0x86DD

3. 端口范围

	熟知 0-1023，注册 1024-49151，动态 / 私有 49152-65535

4. MTU 分片

	IP 片偏移以8 B 为单位；MF=1 表示 “后面还有片”

#### 7 面试 / 考研 6 连问

1. “五层模型哪层有拥塞控制？”

	→ 传输层（TCP 拥塞窗口）

2. “路由器工作在第几层？”

	→ 网络层（基于 IP 转发）

3. “交换机与集线器本质区别？”

	→ 交换机链路层（识别 MAC），集线器物理层（比特复制广播）

4. “为什么把物理层单独出来？”

	→ 硬件电气特性与帧解析职责不同，教学更清晰

5. “TCP 三次握手在哪个层？”

	→ 传输层

6. “CRC 检验在哪层完成？”

	→ 链路层（帧尾 FCS 字段）

#### 8 思维导图（文字版）

```plaintext
五层模型
├─应用层──报文──进程交互（HTTP/DNS）
├─传输层──段──端口+可靠/拥塞（TCP/UDP）
├─网络层──包──IP地址+路由（IP/ICMP/OSPF）
├─链路层──帧──MAC+差错（Ethernet/PPP）
└─物理层──比特──信号+介质（1000BASE-T/光纤）
```

##### ✅ 一句话总结

**“五层教学模型 = 物链网传应，封装逐层加头尾，下层为上层提供 SAP 服务，对等实体靠协议虚通信。”**