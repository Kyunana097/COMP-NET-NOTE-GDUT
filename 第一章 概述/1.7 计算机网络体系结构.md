### 1.7.1 计算机网络体系结构的形成

（各功能均因“复杂网络需分层治理”而逐步提炼，成为 OSI/TCPIP 模型分层依据）

1. **差错控制**
	- 目的：让“不可靠信道”变“可靠”
	- 手段：检错码（CRC）、确认重传（ARQ）、超时计时器
	- 分层：主要放在**数据链路层**（逐链路）与**传输层**（端到端）
2. **流量控制**
	- 目的：防止发送方“淹没”接收方
	- 手段：滑动窗口、速率整形、背压（Back-pressure）
	- 分层：**链路层**（停等、后退N帧）、**传输层**（TCP 窗口、拥塞避免）
3. **分段和重装**
	- 目的：大数据块超过下层 MTU 时需切片；接收端按序拼回
	- 手段：标识、序号、片偏移、MF/DF 标志、重装计时器
	- 分层：**网络层**（IP 分片）、**传输层**（TCP/UDP 分段）
4. **路由**
	- 目的：决定分组从源到目的的最佳路径
	- 手段：静态表、距离向量、链路状态、BGP 策略路由
	- 分层：**网络层**核心功能；路由协议（OSPF、BGP）属**应用层**实现
5. **复用和分用**
	- 复用：多路高层会话共用同一条低层链路
	- 分用：到达后依据字段（端口、协议号）正确上交
	- 分层：
		– **传输层**：端口 → 区分进程（TCP/UDP 复用/分用）
		– **网络层**：协议字段 → 区分 ICMP/IGMP/TCP/UDP
		– **链路层**：类型字段 → 区分 IP/ARP
6. **连接建立和释放**
	- 目的：通信前先同步状态，通信后安全回收资源
	- 建立：三次握手；释放：四次挥手；附带序号同步、选项协商
	- 分层：主要出现在**传输层**（TCP）、**会话层**（OSI）；部分链路协议（PPP、HDLC）也有类似阶段

---

#### 开放系统互联参考模型OSI/RM

> 七层模型 —— 从底到顶，**“物链网传会表应”**

------

##### 1. 七层 & 数据单元 & 核心任

| 层         | 英文名       | 数据单元  | 一句话任务             | 典型协议/设备              |
| :--------- | :----------- | :-------- | :--------------------- | :------------------------- |
| 7 应用     | Application  | APDU/报文 | 为用户进程提供网络接口 | HTTP, FTP, DNS, SMTP       |
| 6 表示     | Presentation | PPDU      | 数据格式、加密、压缩   | SSL/TLS, JPEG, ASN.1       |
| 5 会话     | Session      | SPDU      | 建立/管理/同步会话     | NetBIOS, RPC               |
| 4 传输     | Transport    | 段/报文   | 端到端可靠或不可靠传输 | TCP, UDP                   |
| 3 网络     | Network      | 分组/包   | 路由选择与逻辑寻址     | IP, ICMP, OSPF, 路由器     |
| 2 数据链路 | Data Link    | 帧        | 节点-节点可靠+差错控制 | Ethernet, PPP, 网桥/交换机 |
| 1 物理     | Physical     | 比特      | 透明比特流传输         | 电缆、光纤、集线器、中继器 |

------

##### 2. 各层功能口诀

**“物”**传比特，**“链”**成帧；
**“网”**选路，**“传”**端到；
**“会”**对话，**“表”**格式；
**“应”**用接口最终到。

------

##### 3. 层间通信 2 关键词

- **SAP（Service Access Point）**：同一节点相邻层接口，如端口=传输层SAP
- **PDU（Protocol Data Unit）**：本层协议所处理的数据单位，加上首部后交给下一层

------

##### 4. OSI vs TCP/IP 快速对照

| OSI 七层       | TCP/IP 四层 | 说明                  |
| :------------- | :---------- | :-------------------- |
| 应用+表示+会话 | → 应用层    | OSI 细分，TCP/IP 合并 |
| 传输           | → 传输层    | 功能一致              |
| 网络           | → 网络层    | 功能一致              |
| 数据链路+物理  | → 链路层    | TCP/IP 不进一步细分   |

------

##### 5. 面试/选择 6 连击

1. **哪层负责路由？** 网络层
2. **哪层进行流量控制？** 传输层（主要）+链路层
3. **哪层处理比特同步？** 物理层
4. **交换机工作在第几层？** 默认二层（MAC）；三层交换机在网络层
5. **路由器工作在第几层？** 网络层
6. **HTTP 在哪层？** 应用层

------

##### 6. 一张草图（10 秒画）

```
┌─────应用(7)─────┐
├─────表示(6)─────┤  ← 用户数据
├─────会话(5)─────┤
├─────传输(4)─────┤  ← 段/报文
├─────网络(3)─────┤  ← 包/分组
├─────链路(2)─────┤  ← 帧
└─────物理(1)─────┘  ← 比特
      ↑
向下封装·向上解封
```

------

##### ✅ 一句话总结

**“七层模型物链网传会表应，下三层通信子网，上三层资源子网，传输层是端到端分水岭。”**

---

#### 非国际标准TCP/IP（事实上的国际标准）

- **定义**：由 ARPAnet 实践先行、IETF 社区自发制定的协议簇，包含 TCP、IP、UDP、ICMP、ARP、HTTP、DNS 等数百个 RFC，**未经 ISO/ITU-T 等正式立法机构批准**，却因互联网规模扩张成为“**市场选择的全球通用标准**”。
- **特点**
	– 先协议后模型：先有实现再抽象为四层（应用-传输-网络-链路），与 OSI 七层理想模型错位；
	– 开放免费：RFC 公开，无专利壁垒，快速迭代；
	– 简化实用：去掉表示层、会话层，把流量控制、差错控制、连接管理并入传输层与链路层，易于商用实现。
- **结果**：虽未获“法律上国际标准”地位，却凭借**早发布、易实现、免费使用**占据全球市场，成为**事实上的唯一国际互联网标准**

### 1.7.2 协议与划分层次

> 核心：网络按“功能”切片 → 每层运行一组**协议**（规则+格式+时序），**协议三要素 + 接口 + 数据封装**

------

#### 1. 协议（Protocol）三要素

| 要素 | 内容           | 例子                          |
| :--- | :------------- | :---------------------------- |
| 语法 | 数据格式/结构  | TCP 首部 20 B，端口占 2 B     |
| 语义 | 字段含义与操作 | SYN=1 表示“请求同步”          |
| 同步 | 事件先后关系   | 三次握手：SYN → SYN/ACK → ACK |

------

#### 2. 层次划分原则（面试 4 连）

1. 每层**功能明确**——只干一件事
2. 层间**接口清晰**——SAP + 最少信息
3. **对等通信**——同层协议实体“虚拟对话”
4. **封装/解封**——数据 + 本层首部 → 交给下一层

------

#### 3. 封装解封流程（10 秒画）

```
App 数据
↓ ＋H7
Segment (H6)  ← 传输层
↓ ＋H5
Packet   (H5)  ← 网络层
↓ ＋H4＋T4
Frame    (H4+T4) ← 链路层
↓ 比特
物理链路
```

> 接收端反向逐层拆头/尾，上交。

------

#### 4. 关键术语（选择/填空）

- **PDU**（Protocol Data Unit）：本层协议处理的数据单位
- **SAP**（Service Access Point）：相邻层接口，如“端口”=传输层 SAP
- **对等实体**（Peer Entity）：不同机器同一层的协议实例
- **虚拟通信**（Virtual Communication）：逻辑上同层直接对话，实际沿实线箭头经过下层

------

#### 5. 一张图秒懂“协议栈”

```
主机A                      主机B
┌─────┐ 虚拟通信  ┌─────┐
│应用层│←─HTTP──→│应用层│
├─────┤          ├─────┤
│传输层│←─TCP──→│传输层│
├─────┤          ├─────┤
│网络层│←─IP───→│网络层│
├─────┤          ├─────┤
│链路层│←─Eth──→│链路层│
└─────┘          └─────┘
  ↑物理层↑ 真实比特流 ↑物理层↑
```

------

#### 6. 面试金句

> “协议是水平的——对等实体遵守；服务是垂直的——上层使用下层功能。”

### 1.7.3 具有五层协议的体系结构

#### 1 为什么提出五层模型？

| 背景        | 痛点                                                        |
| ----------- | ----------------------------------------------------------- |
| OSI 七层    | 理论完美，但表示/会话层在现实中常被合并，太细               |
| TCP/IP 四层 | 事实标准，但“链路+物理”一层不利于初学者理解硬件 vs 软件职责 |
| 教学折中    | 把“链路”再拆成物理+数据链路 → **五层清晰、可画、可考**      |

---

#### 2 五层速查表

| 层         | 英文名      | 数据单元     | 地址标识                  | 核心功能                                    | 典型协议/标准                       | 典型设备             |
| ---------- | ----------- | ------------ | ------------------------- | ------------------------------------------- | ----------------------------------- | -------------------- |
| 5 应用     | Application | 报文 message | 进程标识（端口）          | 用户进程 ↔ 网络服务                         | HTTP, FTP, SMTP, DNS, DHCP          | 网关、应用层防火墙   |
| 4 传输     | Transport   | 段 segment   | 端口 (16 bit)             | 端到端进程寻址+可靠/流量/拥塞控制           | TCP, UDP, QUIC                      | 传输层网关           |
| 3 网络     | Network     | 分组 packet  | IP 地址 (32/128 bit)      | 逻辑寻址、路由选择、分组转发                | IP, ICMP, ARP, OSPF, BGP            | 路由器、三层交换机   |
| 2 数据链路 | Data Link   | 帧 frame     | MAC 地址 (48 bit)         | 节点-节点可靠、差错检测、流量控制、介质访问 | Ethernet V2, PPP, HDLC, IEEE 802.11 | 网桥、二层交换机     |
| 1 物理     | Physical    | 比特 bit     | 无地址，按“时钟+信号”识别 | 透明比特流传输、电气/光学特性、机械接口     | RJ-45, 光纤, Wi-Fi射频, 1000BASE-T  | 集线器、中继器、网线 |

---

#### 3 各层深度拆解

##### 3.1 物理层（位流）

- **四大特性**（机械、电气、功能、规程）  
- **信号类型**：基带/宽带、模拟/数字、编码（NRZ, Manchester）  
- **带宽与波特率**：波特率=符号率；奈氏准则→最大码元速率，香农→最大信息速率  
- **传输介质**：双绞线(UTP/STP)、同轴、光纤(单/多模)、无线(2.4 GHz/5 GHz)  
- **设备**：集线器（Hub）→ 物理层广播放大，不识别帧

##### 3.2 数据链路层（帧）

- **成帧**：字符计数、首尾标志、比特填充（HDLC）、违规编码（以太网前导码）  
- **差错控制**：CRC（循环冗余检验）、海明码  
- **流量控制**：停等、回退N帧(GBN)、选择重传(SR)  
- **介质访问**（广播型链路）：  
  – 静态：FDM、TDM、WDM  
  – 动态：CSMA/CD（以太网）、CSMA/CA（Wi-Fi）、令牌传递  
- **以太网帧格式**：7B前导+1B SFD+14B头+数据+4B FCS → 最大 1518 B（不含 VLAN）  
- **设备**：网桥/交换机 → 自学习、隔离冲突域、不隔离广播域

##### 3.3 网络层（分组）

- **逻辑地址**：IPv4 32 位点分十进制、IPv6 128 位冒分十六  
- **分类编址 → CIDR**：网络号+主机号 → 前缀/掩码，路由聚合  
- **ARP 解析**：IP→MAC；免费 ARP 检测冲突  
- **ICMP 控制/差错**：Echo(ping)、Destination Unreachable、TTL-exceeded(Traceroute)  
- **路由算法**：  
  – 静态/动态；域内(RIP-距离向量、OSPF-链路状态)、域间(BGP-路径向量)  
- **分组转发**：最长前缀匹配、下一跳、默认路由  
- **设备**：路由器 → 隔离广播域，基于 IP 地址转发，维护路由表

##### 3.4 传输层（段）

- **复用/分用**：源端口+目的端口+协议号 → 唯一套接字  
- **UDP**：无连接、无状态、首部 8 B、校验和可选、适用于 DNS/DHCP/视频流  
- **TCP**：  
  – 可靠：序号、确认、重传（超时+快速重传）  
  – 流量控制：滑动窗口、接收窗口 (rwnd)  
  – 拥塞控制：慢启动、拥塞避免、快速重传/恢复、拥塞窗口 (cwnd)  
  – 连接管理：三次握手、四次挥手、有限状态机、TIME_WAIT 2MSL  
- **SCTP/QUIC**：多流、多宿、低延迟握手机制（1-RTT/0-RTT）

##### 3.5 应用层（报文）

- **客户/服务器 vs P2P**  
- **DNS**：递归+迭代查询、端口 53、UDP 为主、资源记录(A/AAAA/CNAME/MX/NS)  
- **HTTP/1.1**：持久连接、流水线、Cookie/Session、状态码 1xx-5xx  
- **HTTPS**：TLS 握手(1.3→0-RTT)、加密套件、证书链  
- **Email**：SMTP(发)-端口25/587、POP3(收)-110、IMAP-143  
- **FTP**：控制21+数据20(主动)/随机(被动)  
- **DHCP**：Discover→Offer→Request→ACK，67/68 UDP，四步租约

---

#### 4 数据封装/解封全流程（五层视角）

假设主机 A → 主机 B 发送一条 HTTP GET：

```
【应用层】HTTP GET 报文
↓ +应用头（0 B，HTTP 无额外头）
【传输层】TCP 段：+20 B 首部（源端口随机，目的80，Seq，Ack）
↓ +网络头 20 B（IP 头：源 IP，目的 IP，协议=6，总长度）
【链路层】以太网帧：+14 B 头（DMAC+SMAC+类型）+4 B FCS
↓ → 比特流
【物理层】1000BASE-T 电信号 → 经过交换机、路由器 → B
```
B 从物理层逐层拆头，上交至浏览器进程。

---

#### 5 与 OSI / TCP/IP 的横向对比

| 维度      | OSI 七层         | 五层教学       | TCP/IP 四层    |
| --------- | ---------------- | -------------- | -------------- |
| 层数      | 7                | 5              | 4              |
| 表示/会话 | 独立             | 并入应用       | 并入应用       |
| 物理/链路 | 独立             | 独立           | 合并为“链路”   |
| 法律地位  | 国际标准(ISO)    | 教学标准       | 事实标准(IETF) |
| 使用场景  | 理论、考试、论文 | 课堂、考研大题 | 工程实现       |

---

#### 6 经典计算与题型

1. **封装后总长度**  
   1500 B IP 数据报 → 以太网帧 = 1500 + 14 + 4 = **1518 B**（不含 8 B 前导）

2. **协议字段值**  
   IP 上层协议号：TCP=6，UDP=17，ICMP=1  
   以太网类型：IPv4=0x0800，ARP=0x0806，IPv6=0x86DD

3. **端口范围**  
   熟知 0-1023，注册 1024-49151，动态/私有 49152-65535

4. **MTU 分片**  
   IP 片偏移以 **8 B 为单位**；MF=1 表示“后面还有片”

---

#### 7 面试/考研 6 连问

1. **“五层模型哪层有拥塞控制？”**  
   → 传输层（TCP 拥塞窗口）

2. **“路由器工作在第几层？”**  
   → 网络层（基于 IP 转发）

3. **“交换机与集线器本质区别？”**  
   → 交换机链路层（识别 MAC），集线器物理层（比特复制广播）

4. **“为什么把物理层单独出来？”**  
   → 硬件电气特性与帧解析职责不同，教学更清晰

5. **“TCP 三次握手在哪个层？”**  
   → 传输层

6. **“CRC 检验在哪层完成？”**  
   → 链路层（帧尾 FCS 字段）

---

#### 8 思维导图（文字版）

```
五层模型
├─应用层──报文──进程交互（HTTP/DNS）
├─传输层──段──端口+可靠/拥塞（TCP/UDP）
├─网络层──包──IP地址+路由（IP/ICMP/OSPF）
├─链路层──帧──MAC+差错（Ethernet/PPP）
└─物理层──比特──信号+介质（1000BASE-T/光纤）
```

---

##### ✅ 一句话总结

**“五层教学模型=物链网传应，封装逐层加头尾，下层为上层提供SAP服务，对等实体靠协议虚通信。”**